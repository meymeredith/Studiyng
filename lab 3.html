<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">

<script type="text/javascript">
var plot = function(x, y, c) {
    if(isFinite(x) && isFinite(y)) {
        var color = {
            r: plot.color.r,
            g: plot.color.g,
            b: plot.color.b,
            a: plot.color.a*c
        };

        setPixel(x,y, color);
    }
};

function setPixel (x,y,c) {
    var p=canvas.createImageData(1,1);
    p.data[0]=c.r;
    p.data[1]=c.g;
    p.data[2]=c.b;
    p.data[3]=c.a;
    var data = canvas.getImageData(x, y, 1,1).data;
    canvas.putImageData(p,x,y);
}
var ipart = Math.floor;

function fpart(x) {
    return x - Math.floor(x);
}

function rfpart(x) {
    return 1.0 - fpart(x);
}

function drawLine(x0, y0, x1, y1, color) {
    if(color) {
        plot.color = color;
    } 
	else {
        plot.color = {r:0,g:0,b:0,a:255};
    }
    var steep = Math.abs(y1 - y0) > Math.abs(x1 - x0);
    if (steep) {
        x0 = y0 + (y0=x0, 0);
        x1 = y1 + (y1=x1, 0);
    }
    if (x0 > x1) {
        x0 = x1 + (x1=x0, 0); 
        y0 = y1 + (y1=y0, 0);
    }

    var dx = x1 - x0;
    var dy = y1 - y0;
    var gradient = dy / dx;

    var xend = Math.round(x0);
    var yend = y0 + gradient * (xend - x0);
    var xgap = rfpart(x0 + 0.5);
    var xpxl1 = xend;
    var ypxl1 = ipart(yend);

    if (steep) {
        plot(ypxl1, xpxl1, rfpart(yend) * xgap);
        plot(ypxl1 + 1, xpxl1, fpart(yend) * xgap);
    } 
	else {
        plot(xpxl1, ypxl1, rfpart(yend) * xgap);
        plot(xpxl1, ypxl1 + 1, fpart(yend) * xgap);
    }
    var intery = yend + gradient;

    xend = Math.round(x1);
    yend = y1 + gradient * (xend - x1);
    xgap = fpart(x1 + 0.5);
    var xpxl2 = xend;
    var ypxl2 = ipart(yend);

    if (steep) {
        plot(ypxl2, xpxl2, rfpart(yend) * xgap);
        plot(ypxl2 + 1, xpxl2, fpart(yend) * xgap);
    } 
	else {
        plot(xpxl2, ypxl2, rfpart(yend) * xgap);
        plot(xpxl2, ypxl2 + 1, fpart(yend) * xgap);
    }

    for (var x = xpxl1 + 1; x <= xpxl2 - 1; x++) {
        if (steep) {
            plot(ipart(intery), x, rfpart(intery));
            plot(ipart(intery) + 1, x, fpart(intery));
        } 
		else {
            plot(x, ipart(intery), rfpart(intery));
            plot(x, ipart(intery) + 1, fpart(intery));
        }
        intery = intery + gradient;
    }
}
function drawCircle(x,y, radius, color) {
    if(color)  {
        plot.color = color;
    } 
	else {
        plot.color = {r:0,g:0,b:0,a:255};
    }
    var x0 = 0, y0 = radius, gap = 0, delta = (2 - 2 * radius);
    while (y0 >= 0) {
        plot(x + x0, y - y0, 1);
        plot(x - x0, y - y0, 1);
        plot(x - x0, y + y0, 1);
        plot(x + x0, y + y0, 1);
        gap = 2 * (delta + y0) - 1;
        if (delta < 0 && gap <= 0) {
            x0++;
            delta += 2 * x0 + 1;
            continue;
        }
        if (delta > 0 && gap > 0) {
            y0--;
            delta -= 2 * y0 + 1;
            continue;
        }
        x0++;
        delta += 2 * (x0 - y0);
        y0--;
    }
}
function fill(x, y, color) {
    var startColor = canvas.getImageData(x, y, 1,1).data;
    plot.color = color;
    var q = [[x,y]];
    for(var i = 0; i!= q.length; i++) {
        var x = q[i][0], y = q[i][1];
        var data = canvas.getImageData(x, y, 1,1).data;
        if(x>=0 && y>=0 && x<canvasX && y<canvasY && data[0]==startColor[0] && data[1]==startColor[1] && data[2]==startColor[2] && data[3]==startColor[3]) {
            plot(x, y, 1);
            var s = q.length;
            q[s] = [x+1, y];
            q[s+1] = [x-1, y];
            q[s+2] = [x, y+1];
            q[s+3] = [x, y-1];
        }
    }
}

function drawSpline(color) {
    var args = Array.prototype.slice.call(arguments, 1);
    var coords = [];
    var num = 0;
    for(var i=0; i<args.length; i+=2) {
        coords[i/2+1] = {X:args[i], Y:args[i+1]};
        if(i>0) {
            var deltaX = coords[i/2+1].X - coords[i/2].X;
            var deltaY = coords[i/2+1].Y - coords[i/2].Y;
            num += Math.sqrt(deltaX*deltaX+deltaY*deltaY);
        }
    }
    coords[0] = coords[1];
    coords[coords.length] = coords[coords.length-1];
    plot.color = color;
    for (var i = 1; i <= coords.length-3; i++) {
        var a = [], b = [];
        arrs = {a:a, b:b};
        SplineCoefficient(i, arrs, coords);
        var points = {};
        for(var j=0;j<num;j++) {
           var t = j/num;
            // beta-spline
            points.X = (arrs.a[0] + t * (arrs.a[1] + t * (arrs.a[2] + t * arrs.a[3])));
            points.Y = (arrs.b[0] + t * (arrs.b[1] + t * (arrs.b[2] + t * arrs.b[3])));
            plot(points.X, points.Y,color.a/255);
        }
 
    }
}


function SplineCoefficient(i, arrs, coords) {
	arrs.a[3] = (-coords[i - 1].X + 3*coords[i].X - 3*coords[i + 1].X + coords[i + 2].X)/6;	
	arrs.a[2] = (coords[i - 1].X - 2*coords[i].X + coords[i + 1].X)/2;	
	arrs.a[1] = (-coords[i - 1].X + coords[i + 1].X)/2;	
	arrs.a[0] = (coords[i - 1].X + 4*coords[i].X + coords[i + 1].X)/6;	
	arrs.b[3] = (-coords[i - 1].Y + 3*coords[i].Y - 3*coords[i + 1].Y + coords[i + 2].Y)/6;	
	arrs.b[2] = (coords[i - 1].Y - 2*coords[i].Y + coords[i + 1].Y)/2;	
	arrs.b[1] = (-coords[i - 1].Y + coords[i + 1].Y)/2;	
	arrs.b[0] = (coords[i - 1].Y + 4*coords[i].Y + coords[i + 1].Y)/6;
}
    
function drawRect (x,y,width, height, color) {
    drawLine(x, y, x+width , y, color );
    drawLine(x+width, y, x+width , y+height, color );
    drawLine(x+width, y+height, x , y+height, color );
    drawLine(x, y+height, x , y, color );
}

</script>
</head>
<body style="margin: 10; height: 10vh; ">
<script type="text/javascript">
    var canvasElem= document.createElement('canvas');
    canvasElem.id     = "canvas";
    canvasElem.width  = 500;
    canvasElem.height = 400;
	canvasElem.style.margin = 'auto';
    canvasElem.style.display = 'flex';
    document.body.appendChild(canvasElem);
    canvas = canvasElem.getContext('2d');
    canvasX = canvasElem.width;
    canvasY = canvasElem.height;
	canvas.rect(0,0,500,400);
    // Голова
    fill(5, 5, {r:255, g:255, b:255, a:255});
    drawCircle(250, 180, 150, {r:225, g:149, b:139, a:255});
    fill(250, 200, {r:255, g:223, b:196, a:255});
    // Бровь, нос, усы, квадратный рот, глаза
    drawLine(150,100,350,100,{r:0, g:0, b:0, a: 255});
    drawSpline({r:0, g:0, b:0, a:255},260,255,320,250,350,260,450,240);
    drawSpline({r:0, g:0, b:0, a:255},240,255,180,250,150,260,50,240);
    drawSpline({r:0, g:0, b:0, a:255},255,120,270,250,250,240);
    drawSpline({r:0, g:0, b:0, a:255},245,120,230,250,250,240);
    drawCircle(180, 150, 30, {r:255, g:255, b:255, a:255});
    fill(180, 150, {r:255, g:255, b:255, a:255});
    drawCircle(320, 150, 30, {r:255, g:255, b:255, a:255});
    fill(320, 150, {r:255, g:255, b:255, a:255});
    drawRect(175,260,150,40,{r:225, g:149, b:139, a:255});
    fill(185,270,{r:255, g:255, b:255, a:255});
</script>
</body>